gog.controller("gamesCatalogCtrl",["$scope","config","catalogViewStorage","catalogUrlParameters","choiceFactory","choiceGroupFactory","$timeout","seekerFactory","scrollManager","user","$sce","gtmEventSender",function(a,b,c,d,e,f,g,h,i,j,k,l){var m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M;return s=10,A=!1,p=!1,q=!1,C=!1,t=h.getProductsSeeker(b.urls.search.filtering),D={},K=function(b){var c,d,e,f;for(f=gogData.sort.choices,d=0,e=f.length;d<e;d++)if(c=f[d],c.slug===b)return a.sortSlug=c.slug,a.sortTitle=c.title,!0;return!1},y=function(a){var b,c,d,g,h,i,j,k,l;for(d=[],g=0,j=a.length;g<j;g++)c=a[g],l=c.slug,h=c.is_grouped,i=c.is_multichoice,h?b=new GroupFilter(f.createChoiceGroupCollection(c.groups)):(k=e.createPaginatedChoiceCollection(c.choices,s),b=i?new MultiChoiceFilter(k):new SingleChoiceFilter(k)),b.slug(l).title(c.title),d.push(b);return d},B=function(){return A=!0},M=function(){return A=!1},a.nextPage=function(){if(a.currentPage<a.totalPages)return a.currentPage++},a.prevPage=function(){if(a.currentPage>1)return a.currentPage--},J=function(){var b,c,e,f,g,h,i,j,l,n,o,q,r,s,t;for(K(gogData.sort.default_slug),a.isFiltered=!1,a.searchTerm=d.getSearch()||"",a.currentPage=gogData.page,gogData.category&&(p=gogData.category),t=angular.copy(gogData.catalogFilters),f=0,j=t.length;f<j;f++)if(c=t[f],"language"===c.slug){c.choices.sort(m);break}for(g=0,l=t.length;g<l;g++)if(c=t[g],c.is_grouped===!1)for(r=c.choices,h=0,n=r.length;h<n;h++)b=r[h],b.title=k.trustAsHtml(b.title);else{s=c.groups;for(q in s)for(e=s[q],i=0,o=e.length;i<o;i++)b=e[i],b.title=k.trustAsHtml(b.title)}return a.filters=y(t)},n=function(a){return"br"===a?"pt":a},m=function(a,b){return"en"===a.slug?-1:"en"===b.slug?1:n(a.slug)===j.getLanguage().code?-1:n(b.slug)===j.getLanguage().code?1:a.title.localeCompare(b.title)},o=function(){var b;if(b=a.searchTerm,z(),a.searchTerm===b)return F()},x=function(){return a.productsInitialized=!1,C=gogData.mediaType,a.loadingProducts=!1,a.viewMode=c.getMode(),a.viewModeDisplay=u(c.getMode()),a.isExplanationVisible=!1,a.totalPages=gogData.totalPages,J(),L(),o()},L=function(){var b,c;return c={},c.mediaType=C,a.sortSlug&&(c.sort=a.sortSlug),p&&(c.category=p),c.page=a.currentPage,b={},b.page=c.page,b.totalPages=a.totalPages,b.products=gogData.products,t.storeHistoryResult(c,b)},z=function(){var b,c,e,f,g,h,i,j,k;for((j=d.getSearch())&&(a.searchTerm=j),(k=d.getSort())&&K(k),(g=d.getPage())&&(a.currentPage=g),f=d.getFilters(),h=a.filters,i=[],c=0,e=h.length;c<e;c++)b=h[c],p&&"category"===b.slug?i.push(b.selectChoicesBySlugs([p])):b.slug in f?i.push(b.selectChoicesBySlugs(f[b.slug])):i.push(void 0);return i},a.setGridViewMode=function(){return c.setMode("grid"),a.viewMode=c.getMode(),a.viewModeDisplay=u(c.getMode()),I()},a.setListViewMode=function(){return c.setMode("list"),a.viewMode=c.getMode(),a.viewModeDisplay=u(c.getMode()),I()},u=function(a){return"list"===a?"as list":"as grid"},a.sortBy=function(a){if(K(a))return F(!0)},a.toggleGroup=function(a,b){if(a.isGrouped)return a.toggleGroup(b),F(!0)},a.toggleChoice=function(a,b){var c;return"category"===a.slug?(c=window.location.search,window.location="/games/"+b.slug+c):(a.toggle(b),F(!0))},a.clearFilter=function(a){var b;return d.removeParam(a.slug),B(),"category"===a.slug?(b=window.location.search,void(window.location="/games"+b)):(a.clear(),M(),F(!0))},a.clearFilters=function(){return window.location="movie"===C?"/movies":"/games"},a.clearValue=function(){return a.searchTerm=""},a.onSearchBlur=function(){a.isExplanationVisible=!1},a.onSearchFocus=function(){a.isExplanationVisible=!0},H=function(){return a.searchTerm.length>1},w=function(){var b,c,d,e,f,g;c={},c.mediaType=C,H()&&(c.search=a.searchTerm),a.sortSlug&&(c.sort=a.sortSlug),e=a.filters;for(f in e)b=e[f],(d=b.getQueryParam())&&(f=d[0],g=d[1],c[f]=g);return c.page=a.currentPage,c},v=function(){var a;return a=w(),null!=a.category&&delete a.category,null!=a.mediaType&&delete a.mediaType,a},r=function(b){var c;return c=angular.copy(b),null!=c.page&&delete c.page,null!=c.sort&&c.sort===gogData.sort.default_slug&&delete c.sort,a.isFiltered=Object.keys(c).length>0},G=function(){return a.products=[],a.currentPage=1,a.totalPages=0,a.loadingProducts=!1,a.productsInitialized=!0,q=!1},E=function(b){return a.products=b.products,a.currentPage=b.page,a.totalPages=b.totalPages,a.loadingProducts=!1,a.productsInitialized=!0,q=!1},F=function(b){var c,e;if(null==b&&(b=!1),!A)return c=v(),b&&(c.page=1),r(c),a.loadingProducts=!0,d.setParams(c),e=w(),i.scrollToY(0),b&&(e.page=1),t.call(e).then(E,G),I()},I=function(){var a,b,d;if(a="NA",d=w(),b={event:"siteSearch",keywordSiteSearch:d.search||a,language:d.language||a,feature:d.feature||a,release:d.release||a,devpub:d.devpub||a,price:d.price||a,sort:d.sort,system:d.system||a,view:c.getMode()},!angular.equals(b,D))return l.sendEvent(b),D=b},x(),a.$watch("searchTerm",function(b,c){if(a.productsInitialized)return F(!0)}),a.$watch("currentPage",function(b,c){return q&&g.cancel(q),q=g(function(){if(b=parseInt(b,10),c=parseInt(c,10),b!==c&&b<=a.totalPages&&b>=1)return a.currentPage=b,F()},500)})}]);
var ChoiceGroup;ChoiceGroup=function(){function a(){this.selectedChoicesCount=0}return a.prototype.title=function(a){return this.title=a,this},a.prototype.choices=function(a){return this.choices=a,this},a.prototype.isSelected=function(){return this.selectedChoicesCount>0},a.prototype.isFullySelected=function(){return this.selectedChoicesCount===this.choices.length},a}();
var Choice;Choice=function(){function a(){this.isSelected=!1}return a.prototype.slug=function(a){return this.slug=a,this},a.prototype.title=function(a){return this.title=a,this},a}();
var Filter,indexOf=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};Filter=function(){function a(){this.isGrouped=!1,this.isMultichoice=!1,this.selectedChoices=[]}return a.prototype.slug=function(a){return this.slug=a,this},a.prototype.title=function(a){return this.title=a,this},a.prototype.toggle=function(a){return a.isSelected?(this.unselect(a),!1):(this.select(a),!0)},a.prototype.select=function(a){if(a.isSelected=!0,indexOf.call(this.selectedChoices,a)<0)return this.selectedChoices.push(a)},a.prototype.unselect=function(a){var b,c,d,e,f,g;for(f=this.selectedChoices,g=[],d=c=0,e=f.length;c<e;d=++c){if(b=f[d],b.slug===a.slug){b.isSelected=!1,this.selectedChoices.splice(d,1);break}g.push(void 0)}return g},a.prototype.isSelected=function(){return this.selectedChoices.length>0},a.prototype.clear=function(){var a,b,c,d,e;for(e=angular.copy(this.selectedChoices),d=[],b=0,c=e.length;b<c;b++)a=e[b],d.push(this.unselect(a));return d},a.prototype.getQueryParam=function(){var a,b,c,d,e;if(this.selectedChoices.length>0){for(e=[],d=this.selectedChoices,b=0,c=d.length;b<c;b++)a=d[b],e.push(a.slug);return e=e.sort(),[this.slug,e.join(",")]}},a}();
var GroupFilter,extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;GroupFilter=function(a){function b(a){this.groups=a,b.__super__.constructor.apply(this,arguments),this.isMultichoice=!0,this.isGrouped=!0}return extend(b,a),b.prototype.selectChoicesBySlugs=function(a){var b,c,d,e,f;for(e=[],c=0,d=a.length;c<d;c++)f=a[c],(b=this.findChoiceBySlug(f))?e.push(this.toggle(b)):e.push(void 0);return e},b.prototype.toggleGroup=function(a){var b,c,d,e,f,g,h,i,j;if(a.isSelected()){for(a.selectedChoicesCount=0,g=a.choices,i=[],c=0,e=g.length;c<e;c++)b=g[c],i.push(this.unselect(b));return i}for(h=a.choices,j=[],d=0,f=h.length;d<f;d++)b=h[d],this.select(b),j.push(a.selectedChoicesCount++);return j},b.prototype.toggle=function(a){var c;if(c=this.findGroupByChoice(a))return a.isSelected?c.selectedChoicesCount--:c.selectedChoicesCount++,b.__super__.toggle.call(this,a)},b.prototype.clear=function(){var a,b,c,d,e;for(b=angular.copy(this.selectedChoices),e=[],c=0,d=b.length;c<d;c++)a=b[c],e.push(this.toggle(a));return e},b.prototype.findChoiceBySlug=function(a){var b,c,d,e,f,g,h,i;for(h=this.groups,d=0,f=h.length;d<f;d++)for(c=h[d],i=c.choices,e=0,g=i.length;e<g;e++)if(b=i[e],b.slug===a)return b},b.prototype.findGroupByChoice=function(a){var b,c,d,e,f,g,h,i;for(h=this.groups,d=0,f=h.length;d<f;d++)for(c=h[d],i=c.choices,e=0,g=i.length;e<g;e++)if(b=i[e],b.slug===a.slug)return c},b}(Filter);
var PaginatedFilter,extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;PaginatedFilter=function(a){function b(a){this.pages=a,b.__super__.constructor.apply(this,arguments),this.currentPage=1,this.totalPages=this.pages.length,this.previousPage=1,this.chosenPage=1}return extend(b,a),b.prototype.selectChoicesBySlugs=function(a){var b,c,d,e,f,g;for(f=[],d=0,e=a.length;d<e;d++)g=a[d],f.push(function(){var a,d,e,f;for(e=this.pages,f=[],a=0,d=e.length;a<d;a++)c=e[a],f.push(function(){var a,d,e;for(e=[],a=0,d=c.length;a<d;a++)b=c[a],b.slug===g?e.push(this.toggle(b)):e.push(void 0);return e}.call(this));return f}.call(this));return f},b.prototype.nextPage=function(){if(this.currentPage<this.totalPages)return this.currentPage++,this.chosenPage=this.currentPage},b.prototype.prevPage=function(){if(this.currentPage>1)return this.currentPage--,this.chosenPage=this.currentPage},b.prototype.changePage=function(){if(this.chosenPage>0&&this.chosenPage<=this.totalPages)return this.currentPage=this.chosenPage},b}(Filter);
var MultiChoiceFilter,extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;MultiChoiceFilter=function(a){function b(a){this.pages=a,b.__super__.constructor.apply(this,arguments),this.isMultichoice=!0}return extend(b,a),b}(PaginatedFilter);
var SingleChoiceFilter,extend=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},hasProp={}.hasOwnProperty;SingleChoiceFilter=function(a){function b(a){this.pages=a,b.__super__.constructor.apply(this,arguments),this.selected=!1,this.totalPages=this.pages.length}return extend(b,a),b.prototype.toggle=function(a){return this.selected&&b.__super__.toggle.call(this,this.selected),b.__super__.toggle.call(this,a),this.selected=a},b.prototype.clear=function(){return b.__super__.clear.call(this),this.selected=!1},b}(PaginatedFilter);
var indexOf=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};gog.factory("catalogViewStorage",["$localStorage","eventDispatcher","config",function(a,b,c){return new(function(){function d(){this.loadStorage(),b.on(c.event.storage.reset,function(a){return function(){return a.reset()}}(this))}return d.prototype.MODE_GRID="grid",d.prototype.MODE_LIST="list",d.reset=function(){return this.loadStorage()},d.prototype.getMode=function(){return this.storage.catalogView.mode},d.prototype.setMode=function(a){return indexOf.call(this.availableModes(),a)<0&&(a=this.defaultMode()),this.storage.catalogView.mode=a},d.prototype.availableModes=function(){return[this.MODE_GRID,this.MODE_LIST]},d.prototype.loadStorage=function(){return this.storage=a.$default(this.storageDefaults())},d.prototype.defaultMode=function(){return this.MODE_GRID},d.prototype.storageDefaults=function(){return{catalogView:{mode:this.defaultMode()}}},d}())}]);
gog.factory("catalogUrlParameters",["$window","$document",function(a,b){return new(function(){function c(){this._params={},this._resetParams(),this._hashInstances=["#/%23","#%23","##","#/","#"],this._sanitizeUrl()}return c.prototype._resetParams=function(){return this._params.filters={},this._params.sort="",this._params.search="",this._params.page=""},c.prototype._sanitizeUrl=function(){var b,c;return b=a.location.hash.length>0,c=a.location.search.length>0,c?(this._removeUrlHash(),this._parseLocationSearch()):b?this._parseLocationHash():void 0},c.prototype._parseLocationSearch=function(){var b;if(b=a.location.search,!(b.length<1))return"?"===b.charAt(0)&&(b=b.slice(1)),this._setParamsFromQueryString(b)},c.prototype._parseLocationHash=function(){var b,c,d,e,f;if(b=a.location.hash,!(b.length<1)){for(f=this._hashInstances,c=0,e=f.length;c<e;c++)d=f[c],b.indexOf(d)!==-1&&(b=b.replace(d,""));return this._setParamsFromQueryString(b)}},c.prototype._setParamsFromQueryString=function(a){var b,c,d,e,f,g,h,i;for(h={},i=a.split("&"),b=0,c=i.length;b<c;b++)d=i[b],e=d.split("="),f=e[0],void 0!==(g=e[1])&&(h[f]=this._decodeParamValue(g));return this.setParams(h)},c.prototype._removeUrlHash=function(){var b;return b=a.location.pathname+a.location.search,this._updateUrl(b)},c.prototype._rebuildBrowserUrl=function(){var b,c,d,e,f,g,h,i;h=[],i=this._params;for(f in i)if(g=i[f],angular.isObject(g))for(b in g)c=g[b],d="",angular.isArray(c)&&(c=this._encodeParamValue(c),d=c.join(",")),""!==d&&h.push(b+"="+d);else""!==g&&(g=this._encodeParamValue(g),h.push(f+"="+g));return e=a.location.pathname+"?"+h.join("&"),this._updateUrl(e)},c.prototype._updateUrl=function(c){return a.history.replaceState(null,b.title,c)},c.prototype._encodeParamValue=function(b){var c,d,e,f;if(angular.isArray(b)){for(e=[],c=0,d=b.length;c<d;c++)f=b[c],e.push(a.encodeURIComponent(f));return e}return a.encodeURIComponent(b)},c.prototype._decodeParamValue=function(b){var c,d;c="";try{c=a.decodeURIComponent(b)}catch(d){d,console.warn("could not decode url param: "+b)}return c},c.prototype.setParams=function(a){var b,c;this._resetParams();for(b in a)switch(c=a[b],b){case"sort":this._params.sort=c;break;case"search":case"searchTerm":this._params.search=c;break;case"page":this._params.page=c;break;default:this._params.filters[b]=c.split(",")}return this._rebuildBrowserUrl()},c.prototype.removeParam=function(a){switch(a){case"sort":this._params.sort=void 0;break;case"search":case"searchTerm":this._params.search=void 0;break;case"page":this._params.page=void 0;break;default:this._params.filters[a]=void 0}return this._rebuildBrowserUrl()},c.prototype.getSort=function(){return this._params.sort},c.prototype.getPage=function(){return this._params.page},c.prototype.getFilters=function(){return this._params.filters},c.prototype.getSearch=function(){return this._params.search},c}())}]);
gog.factory("choiceFactory",function(){return new(function(){function a(){}return a.prototype.createChoiceCollection=function(a){var b,c,d,e;for(c=[],d=0,e=a.length;d<e;d++)b=a[d],c.push((new Choice).slug(b.slug).title(b.title));return c},a.prototype.createPaginatedChoiceCollection=function(a,b){var c;return c=this.createChoiceCollection(a),this.paginate(c,b)},a.prototype.paginate=function(a,b){var c,d,e,f,g,h;if(a.length<=b)return[a];for(g=[],e=c=1,f=Math.ceil(a.length/b);1<=f?c<=f:c>=f;e=1<=f?++c:--c)d=(e-1)*b,h=a.slice(d,d+b),g.push(h);return g},a}())});
gog.factory("choiceGroupFactory",["choiceFactory",function(a){return new(function(){function b(a){this.choiceFactory=a}return b.prototype.createChoiceGroupCollection=function(a){var b,c,d;d=[];for(c in a)b=a[c],d.push(this.createChoiceGroup(c,b));return d},b.prototype.createChoiceGroup=function(b,c){return(new ChoiceGroup).title(b).choices(a.createChoiceCollection(c))},b}())}]);
gog.directive("starRating",function(){var a,b,c,d;return b=1,c=2,a=0,d={},d[b]='<i class="ic icon-star-full"></i>',d[c]='<i class="ic icon-star-half"></i>',d[a]='<i class="ic icon-star-empty"></i>',{restrict:"A",link:function(e,f,g){var h,i,j,k,l,m,n,o,p;return m=null,n=new Array(5),o="",h=angular.noop,l=function(){return h=g.$observe("starRating",p)},p=function(a){return m=parseInt(a,10),j(),h(),h=null},j=function(){return k(),i(),f.html(o)},k=function(){var d,e;for(d=e=10;e<=50;d=e+=10)m+2>=d?n.push(b):m+7.5>=d?n.push(c):n.push(a)},i=function(){var a,b,c,e,f;for(f=new Array(5),a=b=0,c=n.length;b<c;a=++b)e=n[a],f[a]=d[e];return o=f.join("")},l()}}});